---
title: JdbcTemplate(操作数据库模板)的抽取
date: 2017-08-05 07:51:53
tags: 
    - Java
    - mysql
---
### 产生的背景
操作的数据库的四大行为:增,删,该,查,用 Jdbc操作数据库的时候.需要有这么一个流程1.注册数据库驱动2.连接数据库3.获取SQL 语句体4.执行 SQL5.处理查询结果.每次操作数据库都要执行类似的几步.代码重复的地方很多,所以要抽取重复的代码.

<!---more--->

### 我们想要的效果
编写一句 SQL 传给数据操作工具类,让这个工具类帮我执行那些类似的增删改查的操作
![productImp](http://7xtc4k.com1.z0.glb.clouddn.com/productImpl.png)
这个样子差多就是想要的结果.

### 抽取的思路
通过观察增,删,改的语句比较类似可以抽取为一个模板,查询所有和查询某一个的语句比较相似可以抽取为一个模板.
在抽取增删改的语句模板比较好处理,这三个操作不需要处理结果集.
1.获取连接
2.通过传入的 SQL 语句得到一个 preparedStatement对象
3.遍历传入的参数,设置到 SQL 中
4.preparedStatement对象执行操作.
查询的操作的比以上的多一个处理结果集的操作.每个表的在处理结果集的时候,处理的方法也不同.最终想要到结果是把数据库中每一列的字段封装成 doMain对象.因为处理结果集的方式不同,在抽出模板方法的时候就要引入`协议`来解决这个问题.

### 抽取处理结果集
千言万语都在一张图中表达吧
![Interface](http://7xtc4k.com1.z0.glb.clouddn.com/Interface.png)
协议体现他的价值所在

### 美中不足
在处理结果集的时候,需要从结果集中一个字段一个字段的赋值给数据模型(Java 中doMain 对象,iOS 中的 modle 对象),在前端展示的时候还要把数据模型各种传来传去,然后 UI 控件中的显示的数据要从数据模型中一个字段一个字段取.这种代码量很大但是没有啥意义的代码.应该有一个东西直接从数据库表的字段映射到 UI 控件中(这他么太省事了,由于业务逻辑,前后端的问题,安全性的问题这都是我一个人在意淫).KVO 的方式可以解决后端领域中数据库表字段到后端的数据模型,kvo 也可以解决客户端领域中从网络节点到前端的数据模型的映射过程.在 Java 代码中如何实现呢.我还没有尝试过.我觉得应该是利用反射获取到结果集的所有字段,然后复制给 domain 的对应字段.

